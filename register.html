<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> User registration </title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/style.css">

</head>
<body>

<div id="startingInfoArea" class="container">

    <div class="whitespace-separator"></div>

    <h1>Enter participants information</h1>

    <br>

    <h3>Register participant</h3>
    <div class="twelve columns">

        <div class="six columns">

            <h5>User information</h5>

            <form>
                <div class="row">

                    <div class="six columns">
                        <label for="emailInput">E-mail</label>
                        <input class="u-full-width" type="email" placeholder="e.g. user@mail.com" id="emailInput">
                        <label for="passInput">Password</label>
                        <input class="u-full-width" type="text" placeholder="6 characters minimum!" id="passInput">
                    </div>

                    <div class="six columns">
                        <label for="nicknameInput">Participants number (Nickname)</label>
                        <input class="u-full-width" type="text" placeholder="e.g. GS016 or Colibri" id="nicknameInput">

                        <label for="firstNameInput">First Name</label>
                        <input class="u-full-width" type="text" placeholder="e.g. John" id="firstNameInput">
                    </div>

                    <div class="twelve columns">
                        <div class="six columns">
                            <h5>Gender</h5>
                            <div class="twelve columns">
                                <form>
                                    <div class="six columns">
                                        <label for="maleRadioBtn">Male</label>
                                        <input type="radio" name="gender" value="male" id="maleRadioBtn" checked>
                                    </div>
                                    <div class="six columns">
                                        <label for="femaleRadioBtn">Female</label>
                                        <input type="radio" name="gender" value="female" id="femaleRadioBtn">
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="six columns">
                            <label for="ageInput">Age</label>
                            <input class="u-full-width" type="number" placeholder="e.g. 34" id="ageInput">
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="six columns">
            <div class="row">

                <div class="twelve columns">

                    <h5>Language - Localization Settings</h5>

                    <div class="two columns">
                        <label for="englishRadioBtn">English</label>
                        <input type="radio" name="lang" value="english" id="englishRadioBtn" checked>
                    </div>
                    <div class="two columns">
                        <label for="greekRadioBtn">Greek</label>
                        <input type="radio" name="lang" value="greek" id="greekRadioBtn">
                    </div>
                    <div class="two columns">
                        <label for="hebrewRadioBtn">Hebrew</label>
                        <input type="radio" name="lang" value="hebrew" id="hebrewRadioBtn">
                    </div>
                </div>

                <div class="twelve columns">
                    <div class="whitespace-separator"></div>
                    <label>
                        <input type="checkbox" id="quizCheckbox">
                        <span class="label-body">Translate Quiz questions to local language</span>
                    </label>
                </div>
            </div>
        </div>

        <button class="button-primary button-block" id="registerButton">Register</button>
    </div>
</div>


<div id="endArea" class="container" style="display: none;">

    <div class="whitespace-separator"></div>

    <h1>Account created!</h1>
    <br>

    <h3>Please copy your e-mail & password</h3>
    <div class="twelve columns">

        <div class="row">
            <div class="six columns">
                <label for="emailReadOnly">Your email</label>
                <input class="u-full-width" type="email" id="emailReadOnly" readonly>
            </div>
            <div class="six columns">
                <label for="passReadOnly">Your password</label>
                <input class="u-full-width" type="text" id="passReadOnly" readonly>
            </div>
        </div>


    </div>
</div>


<script type="text/javascript" src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
<script>

    // Initialize Firebase
    // TODO get apiKey & projectId information from GTW (along with email & password)
    var config = {
        apiKey: "AIzaSyBMa9gSXsoDo27S7P959QZYf3rJBGDGEIA",
        projectId: "mamem-phase2-fall17"
    };
    config.authDomain = config.projectId + ".firebaseapp.com";
    config.databaseURL = "https://" + config.projectId + ".firebaseio.com";
    config.storageBucket = config.projectId + ".appspot.com";

    firebase.initializeApp(config);

    var info = [];

    document.getElementById("registerButton").onclick = function() {

        info.firstName = document.getElementById("firstNameInput").value;
        info.nickname = document.getElementById("nicknameInput").value;

        // Capitalize First letter First name
        info.firstName = info.firstName.charAt(0).toUpperCase() + info.firstName.slice(1);
        /*user.nickname = user.nickname.charAt(0).toUpperCase() + user.nickname.slice(1);*/

        info.email = document.getElementById("emailInput").value;
        info.password = document.getElementById("passInput").value;
        info.gender = document.querySelector('input[name="gender"]:checked').value;
        info.age = document.getElementById("ageInput").value;

        if (!info.email || !info.password || !info.firstName || !info.nickname || !info.gender || !info.age) {
            alert('Please fill in all Register fields!');
            return 0;
        }

        if (info.password.length < 6) {
            alert('Password should be longer than 6 chars!');
            return 0;
        }

        info.language = document.querySelector('input[name="lang"]:checked').value;
        info.translation = document.getElementById("quizCheckbox").checked;

        firebase.auth().createUserWithEmailAndPassword(info.email, info.password).then(function() {

            var currentUser =  firebase.auth().currentUser;

            if (currentUser != null) {

                // When saving data on first level, save name too (to be used on scoreboard).
                firebase.database().ref('users/' + currentUser.uid + '/userDetails').set({
                    "nickname": info.nickname,
                    "firstName": info.firstName,
                    "gender": info.gender,
                    "age": info.age,
                    "lang": info.language,
                    "quizTranslation": info.translation

                }, function (error) {
                    // Account created
                    if (!error) {

                        document.getElementById("emailReadOnly").value = info.email;
                        document.getElementById("passReadOnly").value = info.password;

                        // Redirect to new page.
                        document.getElementById("startingInfoArea").style.display = "none";
                        document.getElementById("endArea").style.display = "block";



                    }
                });

                document.getElementById("registerButton").disabled = true;
                document.getElementById("registerButton").className += " button-disabled";

            } else { alert('Null user'); }

        }, function(error) {
            alert(error.code);
            return error.code;
        });
    };

</script>
</body>
</html>